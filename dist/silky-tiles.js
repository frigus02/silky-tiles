var _Mathfloor=Math.floor,_Mathmax=Math.max,_Mathmin=Math.min;(function(c){"use strict";function d(v,w){return v.touches&&0<v.touches.length?v.touches[0][w]:v[w]}var e=function(v,w){if(!(v instanceof w))throw new TypeError("Cannot call a class as a function")},f=function(){function v(w,z){for(var B,A=0;A<z.length;A++)B=z[A],B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(w,B.key,B)}return function(w,z,A){return z&&v(w.prototype,z),A&&v(w,A),w}}(),g=function(v,w){if("function"!=typeof w&&null!==w)throw new TypeError("Super expression must either be null or a function, not "+typeof w);v.prototype=Object.create(w&&w.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),w&&(Object.setPrototypeOf?Object.setPrototypeOf(v,w):v.__proto__=w)},h=function(v,w){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w&&("object"==typeof w||"function"==typeof w)?w:v},j=function(){function v(){e(this,v),this._listeners={}}return v.prototype.addEventListener=function(z,A){this._getListeners(z).push(A)},v.prototype.dispatchEvent=function(z){for(var A=this._getListeners(z),B=arguments.length,C=Array(1<B?B-1:0),D=1;D<B;D++)C[D-1]=arguments[D];for(var E=A,F=Array.isArray(E),G=0,E=F?E:E[Symbol.iterator]();;){var H;if(F){if(G>=E.length)break;H=E[G++]}else{if(G=E.next(),G.done)break;H=G.value}var I=H;I.apply(void 0,C)}},v.prototype.removeEventListener=function(z,A){var B=this._getListeners(z),C=B.indexOf(A);-1<C&&B.splice(C,1)},v.prototype._getListeners=function(z){return this._listeners.hasOwnProperty(z)||(this._listeners[z]=[]),this._listeners[z]},v}(),k=function(v){function w(z){e(this,w);var A=h(this,v.call(this));return A._silkyTiles=z,A._adapter=null,A._tile=null,A._startX=0,A._startY=0,A._currentX=0,A._currentY=0,A._initEventListeners=A._initEventListeners.bind(A),A._destroyEventListeners=A._destroyEventListeners.bind(A),A._onDragStart=A._onDragStart.bind(A),A._onDragMove=A._onDragMove.bind(A),A._onDragEnd=A._onDragEnd.bind(A),A}return g(w,v),w.prototype._initEventListeners=function(A){window.PointerEvent?A.addEventListener("pointerdown",this._onDragStart):(A.addEventListener("touchstart",this._onDragStart),A.addEventListener("mousedown",this._onDragStart))},w.prototype._destroyEventListeners=function(A){window.PointerEvent?A.removeEventListener("pointerdown",this._onDragStart):(A.removeEventListener("touchstart",this._onDragStart),A.removeEventListener("mousedown",this._onDragStart))},w.prototype._onDragStart=function(A){if(!this._tile){A.preventDefault(),this._tile=A.currentTarget;var B=this._silkyTiles.getTilePosition(this._tile);this._currentX=d(A,"pageX"),this._currentY=d(A,"pageY"),this._startX=this._currentX-B.x,this._startY=this._currentY-B.y,this._tile.classList.add("st-is-dragging"),window.PointerEvent?(this._tile.addEventListener("pointermove",this._onDragMove),this._tile.addEventListener("pointerup",this._onDragEnd),this._tile.addEventListener("pointercancel",this._onDragEnd),this._tile.setPointerCapture(A.pointerId)):(document.addEventListener("touchmove",this._onDragMove),document.addEventListener("touchend",this._onDragEnd),document.addEventListener("mousemove",this._onDragMove),document.addEventListener("mouseup",this._onDragEnd)),this.dispatchEvent("dragstart",this._tile)}},w.prototype._onDragMove=function(A){this._tile&&(this._currentX=d(A,"pageX"),this._currentY=d(A,"pageY"))},w.prototype._onDragEnd=function(){this._tile&&(window.PointerEvent?(this._tile.removeEventListener("pointermove",this._onDragMove),this._tile.removeEventListener("pointerup",this._onDragEnd),this._tile.removeEventListener("pointercancel",this._onDragEnd)):(document.removeEventListener("touchmove",this._onDragMove),document.removeEventListener("touchend",this._onDragEnd),document.removeEventListener("mousemove",this._onDragMove),document.removeEventListener("mouseup",this._onDragEnd)),this._tile.classList.remove("st-is-dragging"),this.dispatchEvent("dragend",this._tile),this._tile=null)},w.prototype._getTileAtPosition=function(A,B){for(var C=this._adapter.tiles,D=Array.isArray(C),E=0,C=D?C:C[Symbol.iterator]();;){var F;if(D){if(E>=C.length)break;F=C[E++]}else{if(E=C.next(),E.done)break;F=E.value}var G=F,H=this._silkyTiles.getTilePosition(G);if(G!==this._tile&&A>H.x&&A<H.x+H.width&&B>H.y&&B<H.y+H.height)return G}},w.prototype.layout=function(){if(this._tile){var A=this._adapter.getContainerBounds(),B=this._getTileAtPosition(this._currentX-A.absoluteLeft,this._currentY-A.absoluteTop);return B&&this.dispatchEvent("tilemoved",this._tile,B),{x:this._currentX-this._startX,y:this._currentY-this._startY}}},f(w,[{key:"adapter",get:function(){return this._adapter},set:function(A){this._adapter&&(this._adapter.removeEventListener("tileadded",this._initEventListeners),this._adapter.tiles.forEach(this._destroyEventListeners)),this._adapter=A,this._adapter.tiles.forEach(this._initEventListeners),this._adapter.addEventListener("tileadded",this._initEventListeners)}}]),w}(j),l=function(){function v(){e(this,v),this._positions=new WeakMap}return v.prototype.getTilePosition=function(z){return this._positions.get(z)},v.prototype.layout=function(z){var A=this,B=[];return this.onLayout(z,function(C,D){var E=A._positions.get(C);E&&E.x===D.x&&E.y===D.y&&E.width===D.width&&E.height===D.height||(A._positions.set(C,D),B.push(C))}),B},v.prototype.onLayout=function(){},v.prototype.onTileAdded=function(){},v.prototype.onTileChanged=function(){},v.prototype.onTileRemoved=function(){},v.prototype.onTileMoved=function(){return[]},v.prototype.onWidthChanged=function(){},f(v,[{key:"height",get:function(){}}]),v}(),m=function(){function v(){e(this,v),this._grid=[],this._tilesInRow=1}return v.prototype.addTile=function(z,A){var B=_Mathmin(A.width,this._tilesInRow),C=A.height,D=void 0,E=void 0,F=void 0,G=void 0;rowLoop:for(D=0,E=C-1;;D++,E++)for(F=0,G=B-1;G<this._tilesInRow;F++,G++)if(this._doesTileFitIntoPosition(D,E,F,G))break rowLoop;for(var H=D;H<=E;H++){for(;this._grid.length<=H;)this._grid.push(Array(this._tilesInRow));for(var I=F;I<=G;I++)this._grid[H][I]=z}return{row:D,col:F}},v.prototype.includesTile=function(z){return this._grid.some(function(A){return A.includes(z)})},v.prototype.getTilePosition=function(z){var A=this._grid.findIndex(function(C){return C.includes(z)}),B=this._grid[A].indexOf(z);return{row:A,col:B}},v.prototype._doesTileFitIntoPosition=function(z,A,B,C){for(var E,D=z;D<=A&&(E=this._grid[D],!!E);D++)for(var F=B;F<=C;F++)if("undefined"!=typeof E[F])return!1;return!0},v.prototype.reset=function(z){this._grid=[],this._tilesInRow=z},v}(),n=function(v){function w(z){e(this,w);var A=h(this,v.call(this));return A._options={columns:5,margin:8,outerMargin:!0,moveMode:"switch"},Object.assign(A._options,z),A._tiles=[],A._queue=[],A._grid=new m,A._grid.reset(A._options.columns),A._tileWidth=1,A._height=0,A}return g(w,v),w.prototype.onLayout=function(A,B){var C=this,D=this._queue.map(function(E){return{tile:E,layoutParams:A(E)}}).sort(function(E,F){return E.layoutParams.position-F.layoutParams.position});return this._queue=[],D.forEach(function(E){var F=E.tile,G=E.layoutParams,H=C._grid.includesTile(F)?C._grid.getTilePosition(F):C._grid.addTile(F,G),I=H.row,J=H.col,K=J*(C._tileWidth+C._options.margin),L=I*(C._tileWidth+C._options.margin);C._options.outerMargin&&(K+=C._options.margin,L+=C._options.margin),C._height=_Mathmax(C._height,(I+1)*(C._tileWidth+C._options.margin)+(C._options.outerMargin?C._options.margin:-C._options.margin)),B(F,{x:K,y:L,width:(C._tileWidth+C._options.margin)*G.width-C._options.margin,height:(C._tileWidth+C._options.margin)*G.height-C._options.margin})}),D},w.prototype.onTileAdded=function(A){this._tiles.push(A),this._queue.push(A)},w.prototype.onTileChanged=function(){this._grid.reset(this._tilesInRow),this._height=0,this._queue=[].concat(this._tiles)},w.prototype.onTileRemoved=function(A){var B=this._tiles.indexOf(A);-1<B&&(this._tiles.splice(B,1),this._grid.reset(this._tilesInRow),this._height=0,this._queue=[].concat(this._tiles))},w.prototype.onTileMoved=function(A,B,C){var D=C(A).position,E=C(B).position,F=[];if("switch"===this._options.moveMode)F.push({tile:A,newPosition:E},{tile:B,newPosition:D});else if("push"===this._options.moveMode){for(var G={},H=this._tiles,I=Array.isArray(H),J=0,H=I?H:H[Symbol.iterator]();;){var K;if(I){if(J>=H.length)break;K=H[J++]}else{if(J=H.next(),J.done)break;K=J.value}var L=K,M=C(L).position;G[M]=L}var N=D>E?1:-1;F.push({tile:A,newPosition:E},{tile:B,newPosition:E+N});for(var R,O=_Mathmin(D,E)+1,P=_Mathmax(D,E)-1,Q=O;Q<=P;Q++)R=G[Q],R&&F.push({tile:R,newPosition:Q+N})}return this._grid.reset(this._tilesInRow),this._height=0,this._queue=[].concat(this._tiles),F},w.prototype.onWidthChanged=function(A){this._tileWidth=this._options.outerMargin?(A-(this._options.columns+1)*this._options.margin)/this._options.columns:(A-(this._options.columns-1)*this._options.margin)/this._options.columns,this._height=0,this._queue=[].concat(this._tiles)},f(w,[{key:"height",get:function(){return this._height}}]),w}(l),o=function(v){function w(z){e(this,w);var A=h(this,v.call(this));return A._options={tileWidth:96,tileHeight:96,margin:8,outerMargin:!0,moveMode:"switch"},Object.assign(A._options,z),A._tiles=[],A._queue=[],A._tilesInRow=1,A._grid=new m,A._height=0,A}return g(w,v),w.prototype.onLayout=function(A,B){var C=this,D=this._queue.map(function(E){return{tile:E,layoutParams:A(E)}}).sort(function(E,F){return E.layoutParams.position-F.layoutParams.position});this._queue=[],D.forEach(function(E){var F=E.tile,G=E.layoutParams,H=C._grid.addTile(F,G),I=H.row,J=H.col,K=J*(C._options.tileWidth+C._options.margin),L=I*(C._options.tileHeight+C._options.margin);C._options.outerMargin&&(K+=C._options.margin,L+=C._options.margin),C._height=_Mathmax(C._height,(I+G.height)*(C._options.tileHeight+C._options.margin)+(C._options.outerMargin?C._options.margin:-C._options.margin)),B(F,{x:K,y:L,width:(C._options.tileWidth+C._options.margin)*G.width-C._options.margin,height:(C._options.tileHeight+C._options.margin)*G.height-C._options.margin})})},w.prototype.onTileAdded=function(A){this._tiles.push(A),this._queue.push(A)},w.prototype.onTileChanged=function(){this._grid.reset(this._tilesInRow),this._height=0,this._queue=[].concat(this._tiles)},w.prototype.onTileRemoved=function(A){var B=this._tiles.indexOf(A);-1<B&&(this._tiles.splice(B,1),this._grid.reset(this._tilesInRow),this._height=0,this._queue=[].concat(this._tiles))},w.prototype.onTileMoved=function(A,B,C){var D=C(A).position,E=C(B).position,F=[];if("switch"===this._options.moveMode)F.push({tile:A,newPosition:E},{tile:B,newPosition:D});else if("push"===this._options.moveMode){for(var G={},H=this._tiles,I=Array.isArray(H),J=0,H=I?H:H[Symbol.iterator]();;){var K;if(I){if(J>=H.length)break;K=H[J++]}else{if(J=H.next(),J.done)break;K=J.value}var L=K,M=C(L).position;G[M]=L}var N=D>E?1:-1;F.push({tile:A,newPosition:E},{tile:B,newPosition:E+N});for(var R,O=_Mathmin(D,E)+1,P=_Mathmax(D,E)-1,Q=O;Q<=P;Q++)R=G[Q],R&&F.push({tile:R,newPosition:Q+N})}return this._grid.reset(this._tilesInRow),this._height=0,this._queue=[].concat(this._tiles),F},w.prototype.onWidthChanged=function(A){this._tilesInRow=this._options.outerMargin?_Mathfloor((A-this._options.margin)/(this._options.tileWidth+this._options.margin)):_Mathfloor((A+this._options.margin)/(this._options.tileWidth+this._options.margin)),1>this._tilesInRow&&(this._tilesInRow=1),this._grid.reset(this._tilesInRow),this._height=0,this._queue=[].concat(this._tiles)},f(w,[{key:"height",get:function(){return this._height}}]),w}(l),p=function(v){function w(){return e(this,w),h(this,v.call(this))}return g(w,v),w.prototype.getContainerBounds=function(){return{}},w.prototype.getTileBounds=function(){return{}},w.prototype.getTileLayoutParams=function(){},w.prototype.onTilePositionChanged=function(){},f(w,[{key:"container",get:function(){}},{key:"tiles",get:function(){return[]}}]),w}(j),q=function(v){function w(z){e(this,w);var A=h(this,v.call(this));return A._containerElement=z,A._containerElement.classList.add("st-container"),A._tiles=Array.from(z.children),A._tiles.forEach(function(B){B.classList.add("st-tile")}),A._onChildrenMutated=A._onChildrenMutated.bind(A),A._observer=new MutationObserver(A._onChildrenMutated),A._observer.observe(z,{childList:!0}),A}return g(w,v),w.prototype._onChildrenMutated=function(A){for(var B=A,C=Array.isArray(B),D=0,B=C?B:B[Symbol.iterator]();;){var E;if(C){if(D>=B.length)break;E=B[D++]}else{if(D=B.next(),D.done)break;E=D.value}for(var F=E,G=F.addedNodes,H=Array.isArray(G),I=0,G=H?G:G[Symbol.iterator]();;){var J;if(H){if(I>=G.length)break;J=G[I++]}else{if(I=G.next(),I.done)break;J=I.value}var K=J;K instanceof Element&&(K.classList.add("st-tile"),this._tiles.push(K),this.dispatchEvent("tileadded",K))}for(var L=F.removedNodes,M=Array.isArray(L),N=0,L=M?L:L[Symbol.iterator]();;){var O;if(M){if(N>=L.length)break;O=L[N++]}else{if(N=L.next(),N.done)break;O=N.value}var P=O;if(P instanceof Element){var Q=this._tiles.indexOf(P);this._tiles.splice(Q,1),this.dispatchEvent("tileremoved",P)}}}},w.prototype.getContainerBounds=function(){var A=this._containerElement.getBoundingClientRect(),B=0,C=0,D=this._containerElement;do B+=D.offsetTop,C+=D.offsetLeft,D=D.offsetParent;while(D);return{top:A.top,left:A.left,absoluteTop:B,absoluteLeft:C}},w.prototype.getTileBounds=function(A){var B=this.getContainerBounds(),C=A.getBoundingClientRect();return{width:C.width,height:C.width,x:C.left-B.left,y:C.top-B.top}},w.prototype.getTileLayoutParams=function(A){return{position:parseInt(A.dataset.tilePosition,10),width:parseInt(A.dataset.tileWidth,10)||1,height:parseInt(A.dataset.tileHeight,10)||1}},w.prototype.onTilePositionChanged=function(A,B){A.dataset.tilePosition=B},f(w,[{key:"container",get:function(){return this._containerElement}},{key:"tiles",get:function(){return this._tiles}}]),w}(p),s=function(){function v(){e(this,v),this._adapter=null,this._layout=null,this._layoutWidth=0,this._layoutHeight=0,this._dragHandler=new k(this),this._draggingTile=null,this._onTileAdded=this._onTileAdded.bind(this),this._onTileChanged=this._onTileChanged.bind(this),this._onTileRemoved=this._onTileRemoved.bind(this),this._onTileDragStart=this._onTileDragStart.bind(this),this._onTileDragEnd=this._onTileDragEnd.bind(this),this._onTileMoved=this._onTileMoved.bind(this),this._update=this._update.bind(this),this._dragHandler.addEventListener("dragstart",this._onTileDragStart),this._dragHandler.addEventListener("dragend",this._onTileDragEnd),this._dragHandler.addEventListener("tilemoved",this._onTileMoved),requestAnimationFrame(this._update)}return v.prototype._onTileAdded=function(z){this._layout&&this._layout.onTileAdded(z)},v.prototype._onTileChanged=function(z){this._layout&&this._layout.onTileChanged(z)},v.prototype._onTileRemoved=function(z){this._layout&&this._layout.onTileRemoved(z)},v.prototype._onTileDragStart=function(z){this._draggingTile=z},v.prototype._onTileDragEnd=function(z){this._draggingTile=null,this._onTileChanged(z)},v.prototype._onTileMoved=function(z,A){var B=this;if(this._layout)for(var C=this._layout.onTileMoved(z,A,function(I){return B._adapter.getTileLayoutParams(I)}),D=C,E=Array.isArray(D),F=0,D=E?D:D[Symbol.iterator]();;){var G;if(E){if(F>=D.length)break;G=D[F++]}else{if(F=D.next(),F.done)break;G=F.value}var H=G;this._adapter.onTilePositionChanged(H.tile,H.newPosition)}},v.prototype._update=function(){var z=this;if(this._adapter&&this._layout){var B,A=[];this._draggingTile&&(B=this._dragHandler.layout(),A.push(this._draggingTile)),this._layoutWidth!==this._adapter.container.clientWidth&&(this._layoutWidth=this._adapter.container.clientWidth,this._layout.onWidthChanged(this._layoutWidth)),A.push.apply(A,this._layout.layout(function(I){return z._adapter.getTileLayoutParams(I)}));for(var C=A,D=Array.isArray(C),E=0,C=D?C:C[Symbol.iterator]();;){var F;if(D){if(E>=C.length)break;F=C[E++]}else{if(E=C.next(),E.done)break;F=E.value}var G=F,H=this._layout.getTilePosition(G);G===this._draggingTile&&Object.assign(H,B),G.style.width=H.width+"px",G.style.height=H.height+"px",G.style.transform="translateX("+H.x+"px) translateY("+H.y+"px)"}this._layoutHeight!==this._layout.height&&(this._layoutHeight=this._layout.height,this._adapter.container.style.height=this._layoutHeight+"px"),requestAnimationFrame(this._update)}},v.prototype.getTilePosition=function(z){return this._layout&&this._layout.getTilePosition(z)},f(v,[{key:"adapter",get:function(){return this._adapter},set:function(z){this._adapter&&(this._adapter.removeEventListener("tileadded",this._onTileAdded),this._adapter.removeEventListener("tilechanged",this._onTileChanged),this._adapter.removeEventListener("tileremoved",this._onTileRemoved),this._adapter.tiles.forEach(this._onTileRemoved)),this._adapter=z,this._adapter.tiles.forEach(this._onTileAdded),this._adapter.addEventListener("tileadded",this._onTileAdded),this._adapter.addEventListener("tilechanged",this._onTileChanged),this._adapter.addEventListener("tileremoved",this._onTileRemoved),this._dragHandler.adapter=this._adapter}},{key:"layout",get:function(){return this._layout},set:function(z){this._layout&&this._adapter&&this._adapter.tiles.forEach(this._onTileRemoved),this._layout=z,this._adapter&&this._adapter.tiles.forEach(this._onTileAdded)}}]),v}();c.SilkyTiles=s,c.layouts={BaseLayout:l,ColumnLayout:n,FlowLayout:o},c.adapters={BaseAdapter:p,DomAdapter:q}})(this.SilkyTiles=this.SilkyTiles||{});
//# sourceMappingURL=silky-tiles.js.map
